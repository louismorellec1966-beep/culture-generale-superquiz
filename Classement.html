<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperQuiz - Classement</title>
    <link rel="stylesheet" href="CSS/style.css">
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script defer src="firebase-config.js"></script>
    <style>
        .classement-header{background:linear-gradient(135deg,#f093fb 0%,#f5576c 100%);color:white;padding:40px;text-align:center;border-radius:10px;margin-bottom:30px}
        .classement-header h1{margin:0;font-size:2.5em}
        .filter-tabs{display:flex;justify-content:center;gap:10px;margin:30px 0;flex-wrap:wrap}
        .filter-tab{padding:12px 30px;background:white;border:2px solid #ecf0f1;border-radius:25px;cursor:pointer;transition:all .3s;font-weight:600;color:#7f8c8d}
        .filter-tab:hover{border-color:#3498db;color:#3498db}
        .filter-tab.active{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border-color:transparent}
        .podium{display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px;max-width:900px;margin:40px auto;align-items:flex-end}
        .podium-place{background:white;border-radius:15px;padding:30px 20px;text-align:center;box-shadow:0 5px 20px rgba(0,0,0,.1);transition:transform .3s}
        .podium-place:hover{transform:translateY(-10px)}
        .podium-place.first{order:2;background:linear-gradient(135deg,#ffd700 0%,#ffed4e 100%);color:#2c3e50;padding:40px 20px}
        .podium-place.second{order:1;background:linear-gradient(135deg,#c0c0c0 0%,#e8e8e8 100%)}
        .podium-place.third{order:3;background:linear-gradient(135deg,#cd7f32 0%,#e89b65 100%);color:white}
        .medal{font-size:4em;margin-bottom:10px;display:block;animation:bounce 2s infinite}
        @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
        .podium-name{font-size:1.3em;font-weight:bold;margin:10px 0}
        .podium-score{font-size:2em;font-weight:bold;margin:10px 0}
        .classement-table{background:white;border-radius:10px;overflow:hidden;box-shadow:0 2px 10px rgba(0,0,0,.1);margin-top:40px}
        .table-header{background:#3498db;color:white;padding:15px;font-weight:bold;display:grid;grid-template-columns:80px 2fr 1fr 1fr 1fr;gap:15px}
        .classement-row{padding:15px;border-bottom:1px solid #ecf0f1;display:grid;grid-template-columns:80px 2fr 1fr 1fr 1fr;gap:15px;align-items:center;transition:background .3s}
        .classement-row:hover{background:#f8f9fa}
        .classement-row.highlight{background:#e3f2fd;border-left:4px solid #3498db}
        .rank{font-size:1.5em;font-weight:bold;text-align:center;color:#3498db}
        .rank.top3{font-size:2em}
        .player-name{font-weight:600;color:#2c3e50}
        .player-score{font-size:1.3em;font-weight:bold;color:#2ecc71}
        .no-data{text-align:center;padding:50px;color:#7f8c8d}
        .stat-box{background:white;padding:20px;border-radius:10px;text-align:center;box-shadow:0 2px 10px rgba(0,0,0,.1)}
        .stat-number{font-size:2.5em;font-weight:bold;color:#3498db}
        .stats-banner{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin:30px 0}
    </style>
</head>
<body>
    <nav>
        <button id="toggle-menu" aria-label="Ouvrir le menu">
            <span class="hamburger"></span>
            <span class="hamburger"></span>
            <span class="hamburger"></span>
        </button>
        <ul class="menu">
            <li><a href="Accueil.html">Accueil</a></li>
            <li class="dropdown">
                <a href="Quiz.html">Quiz</a>
                <ul class="submenu">
                    <li><a href="Histoire.html">Histoire</a></li>
                    <li><a href="G√©ographie.html">G√©ographie</a></li>
                    <li><a href="Science.html">Science</a></li>
                    <li><a href="Litt√©rature.html">Litt√©rature</a></li>
                </ul>
            </li>
            <li><a href="Scores.html">Scores</a></li>
            <li><a href="Classement.html" aria-current="page">üèÜ Classement</a></li>
            <li><a href="Contact.html">Contact</a></li>
        </ul>
    </nav>
    <main>
        <div class="classement-header">
            <h1>üèÜ Classement Global</h1>
            <p>Comparez vos performances !</p>
        </div>
        <div class="stats-banner" id="stats-banner">
            <div class="stat-box"><div class="stat-number">‚è≥</div><div class="stat-label">Chargement...</div></div>
        </div>
        <div class="filter-tabs">
            <div class="filter-tab active" onclick="filterClassement('global')">üåç Global</div>
            <div class="filter-tab" onclick="filterClassement('histoire')">üìú Histoire</div>
            <div class="filter-tab" onclick="filterClassement('geographie')">üó∫Ô∏è G√©o</div>
            <div class="filter-tab" onclick="filterClassement('science')">üî¨ Science</div>
            <div class="filter-tab" onclick="filterClassement('litterature')">üìö Litt√©rature</div>
        </div>
        <div id="podium-container"></div>
        <div class="classement-table">
            <div class="table-header">
                <div>Rang</div><div>Joueur</div><div>Score</div><div>Quiz</div><div>Moy</div>
            </div>
            <div id="classement-list"><div class="no-data"><p>‚è≥ Chargement...</p></div></div>
        </div>
    </main>
    <footer><p>Copyright ¬© 2024 SuperQuiz</p></footer>
    <script src="js/script.js"></script>
    <script>
let currentFilter='global',currentUser=null,allLeaderboard=[];
async function loadClassement(){
    try{
        console.log('üîç Chargement classement...');
        allLeaderboard=await FirebaseScores.getLeaderboard(currentFilter==='global'?null:currentFilter);
        console.log('‚úÖ Classement:', allLeaderboard.length);
        displayStats();displayPodium(allLeaderboard.slice(0,3));displayTable(allLeaderboard);
    }catch(e){
        console.error('‚ùå Erreur:',e);
        document.getElementById('classement-list').innerHTML='<div class="no-data"><h3>Erreur</h3><p>'+e.message+'</p></div>';
    }
}
function displayStats(){
    const total=allLeaderboard.length;
    const quiz=allLeaderboard.reduce((s,u)=>s+(u.quizCount||0),0);
    const pts=allLeaderboard.reduce((s,u)=>s+(u.totalScore||0),0);
    document.getElementById('stats-banner').innerHTML=`
        <div class="stat-box"><div class="stat-number">${total}</div><div class="stat-label">Joueurs</div></div>
        <div class="stat-box"><div class="stat-number">${quiz}</div><div class="stat-label">Quiz</div></div>
        <div class="stat-box"><div class="stat-number">${pts}</div><div class="stat-label">Points</div></div>
    `;
}
function displayPodium(top3){
    const c=document.getElementById('podium-container');
    if(top3.length===0){c.innerHTML='<div class="no-data"><p>Aucun score</p></div>';return}
    const medals=['ü•á','ü•à','ü•â'],pos=['first','second','third'];
    c.innerHTML=`<div class="podium">${top3.map((p,i)=>`
        <div class="podium-place ${pos[i]}">
            <span class="medal">${medals[i]}</span>
            <div class="podium-name">${p.name||'Joueur'}</div>
            <div class="podium-score">${p.totalScore||0}</div>
            <div>${p.quizCount||0} quiz</div>
        </div>
    `).join('')}</div>`;
}
function displayTable(rankings){
    const list=document.getElementById('classement-list');
    if(rankings.length===0){list.innerHTML='<div class="no-data"><p>Aucun score</p></div>';return}
    list.innerHTML=rankings.map((p,i)=>{
        const rank=i+1;
        const isCurrent=currentUser&&p.uid===currentUser.uid;
        const avg=p.quizCount>0?Math.round((p.totalScore/p.quizCount)*10):0;
        return`<div class="${isCurrent?'classement-row highlight':'classement-row'}">
            <div class="${rank<=3?'rank top3':'rank'}">${rank<=3?['ü•á','ü•à','ü•â'][rank-1]:'#'+rank}</div>
            <div class="player-name">${p.name||'Joueur'}${isCurrent?' (Vous)':''}</div>
            <div class="player-score">${p.totalScore||0}</div>
            <div class="quiz-count">${p.quizCount||0}</div>
            <div class="avg-score">${avg}</div>
        </div>`;
    }).join('');
}
async function filterClassement(filter){
    currentFilter=filter;
    document.querySelectorAll('.filter-tab').forEach(t=>t.classList.remove('active'));
    event.target.classList.add('active');
    await loadClassement();
}
async function logout(e){
    e.preventDefault();
    if(confirm('D√©connexion ?')){
        try{await FirebaseAuth.logout();window.location.href='Accueil.html'}
        catch(e){alert('Erreur d√©connexion')}
    }
}
window.addEventListener('load',()=>{
    if(typeof FirebaseAuth==='undefined'){
        setTimeout(()=>location.reload(),2000);return;
    }
    FirebaseAuth.onAuthStateChanged(user=>{
        if(user)currentUser=user;
        loadClassement();
        const nav=document.querySelector('.menu');
        if(!nav)return;
        const exist=document.getElementById('auth-menu-item');
        if(exist)exist.remove();
        const auth=document.createElement('li');
        auth.id='auth-menu-item';
        if(user){
            auth.innerHTML=`<a href="#" onclick="logout(event)" style="color:#2ecc71">üë§ ${user.name}</a>`;
        }else{
            auth.innerHTML='<a href="Auth.html" style="color:#e74c3c">üîê Connexion</a>';
        }
        nav.appendChild(auth);
    });
});
    </script>
</body>
</html>