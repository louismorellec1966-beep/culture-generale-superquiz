<!DOCTYPE html>
<html lang="fr">
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-G3YEKJLDRT"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-G3YEKJLDRT');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="SuperQuiz - Mode Multijoueur - Affrontez d'autres joueurs en temps r√©el">
    <title>SuperQuiz - Mode Multijoueur üéÆ</title>
    
    <link rel="stylesheet" href="CSS/style.css">
    <link rel="stylesheet" href="CSS/multiplayer.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <script src="firebase-config.js"></script>
    <script src="js/menu.js" defer></script>
</head>
<body>
    <main>
        <!-- Section Connexion Requise -->
        <div id="login-required" class="section-card" style="display: none;">
            <div class="login-prompt">
                <h2>üîí Connexion requise</h2>
                <p>Vous devez √™tre connect√© pour acc√©der au mode multijoueur.</p>
                <a href="Auth.html" class="btn-primary">Se connecter</a>
            </div>
        </div>

        <!-- √âcran Principal - Lobby -->
        <div id="lobby-screen" class="section-card">
            <div class="multiplayer-header">
                <h1>‚öîÔ∏è Mode Multijoueur</h1>
                <p class="subtitle">Affrontez des joueurs du monde entier en temps r√©el !</p>
            </div>

            <!-- Stats du joueur -->
            <div class="player-stats-card" id="player-stats">
                <div class="player-info">
                    <div class="player-avatar" id="player-avatar">üë§</div>
                    <div class="player-details">
                        <h3 id="player-name">Chargement...</h3>
                        <div class="rank-badge" id="player-rank">
                            <span class="rank-icon">ü•â</span>
                            <span class="rank-name">Bronze</span>
                        </div>
                    </div>
                </div>
                <div class="elo-display">
                    <div class="elo-score" id="player-elo">1000</div>
                    <div class="elo-label">Points ELO</div>
                </div>
                <div class="stats-mini">
                    <div class="stat-item">
                        <span class="stat-value" id="wins-count">0</span>
                        <span class="stat-label">Victoires</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="losses-count">0</span>
                        <span class="stat-label">D√©faites</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="winrate">0%</span>
                        <span class="stat-label">Winrate</span>
                    </div>
                </div>
            </div>

            <!-- Modes de jeu -->
            <div class="game-modes">
                <h2>üéÆ Choisissez votre mode</h2>
                
                <div class="modes-grid">
                    <!-- Duel 1v1 -->
                    <div class="mode-card" onclick="startMatchmaking('duel')">
                        <div class="mode-icon">‚öîÔ∏è</div>
                        <h3>Duel 1v1</h3>
                        <p>Affrontez un adversaire de niveau similaire</p>
                        <ul class="mode-details">
                            <li>üéØ 10 questions</li>
                            <li>‚è±Ô∏è 15s par question</li>
                            <li>üìä Class√© (ELO)</li>
                        </ul>
                        <button class="btn-play">Jouer</button>
                    </div>

                    <!-- Partie rapide -->
                    <div class="mode-card" onclick="startMatchmaking('quick')">
                        <div class="mode-icon">‚ö°</div>
                        <h3>Partie Rapide</h3>
                        <p>Match rapide sans impact sur le classement</p>
                        <ul class="mode-details">
                            <li>üéØ 5 questions</li>
                            <li>‚è±Ô∏è 10s par question</li>
                            <li>üé≤ Non class√©</li>
                        </ul>
                        <button class="btn-play secondary">Jouer</button>
                    </div>

                    <!-- Tournoi (bient√¥t) -->
                    <div class="mode-card disabled">
                        <div class="mode-icon">üèÜ</div>
                        <h3>Tournoi</h3>
                        <p>Comp√©titions hebdomadaires</p>
                        <div class="coming-soon">Bient√¥t disponible</div>
                    </div>
                </div>
            </div>

            <!-- Classement Multijoueur -->
            <div class="leaderboard-section">
                <h2>üèÖ Classement Multijoueur</h2>
                <div class="leaderboard-tabs">
                    <button class="tab-btn active" onclick="switchLeaderboard('global')">üåç Global</button>
                    <button class="tab-btn" onclick="switchLeaderboard('weekly')">üìÖ Cette semaine</button>
                </div>
                <div class="leaderboard-list" id="leaderboard-list">
                    <div class="loading-spinner">Chargement...</div>
                </div>
            </div>

            <!-- Joueurs en ligne -->
            <div class="online-players">
                <div class="online-indicator">
                    <span class="pulse-dot"></span>
                    <span id="online-count">0</span> joueurs en ligne
                </div>
            </div>
        </div>

        <!-- √âcran Matchmaking -->
        <div id="matchmaking-screen" class="section-card" style="display: none;">
            <div class="matchmaking-container">
                <h2>üîç Recherche d'adversaire...</h2>
                
                <div class="matchmaking-animation">
                    <div class="player-card self">
                        <div class="avatar" id="mm-player-avatar">üë§</div>
                        <div class="name" id="mm-player-name">Vous</div>
                        <div class="elo" id="mm-player-elo">1000</div>
                    </div>
                    
                    <div class="vs-animation">
                        <div class="vs-text">VS</div>
                        <div class="search-spinner"></div>
                    </div>
                    
                    <div class="player-card opponent">
                        <div class="avatar">‚ùì</div>
                        <div class="name">Recherche...</div>
                        <div class="elo">???</div>
                    </div>
                </div>

                <div class="matchmaking-info">
                    <div class="queue-time">
                        <span>Temps d'attente :</span>
                        <span id="queue-timer">0:00</span>
                    </div>
                    <div class="queue-range">
                        <span>Recherche ELO :</span>
                        <span id="elo-range">¬±50</span>
                    </div>
                </div>

                <button class="btn-cancel" onclick="cancelMatchmaking()">
                    ‚ùå Annuler
                </button>
            </div>
        </div>

        <!-- √âcran Adversaire Trouv√© -->
        <div id="opponent-found-screen" class="section-card" style="display: none;">
            <div class="opponent-found-container">
                <h2>‚öîÔ∏è Adversaire trouv√© !</h2>
                
                <div class="versus-display">
                    <div class="player-profile">
                        <div class="avatar large" id="vs-player-avatar">üë§</div>
                        <div class="name" id="vs-player-name">Vous</div>
                        <div class="rank-badge" id="vs-player-rank">ü•â Bronze</div>
                        <div class="elo" id="vs-player-elo">1000 ELO</div>
                    </div>
                    
                    <div class="vs-center">
                        <div class="vs-badge">VS</div>
                        <div class="countdown" id="start-countdown">3</div>
                    </div>
                    
                    <div class="player-profile">
                        <div class="avatar large" id="vs-opponent-avatar">üë§</div>
                        <div class="name" id="vs-opponent-name">Adversaire</div>
                        <div class="rank-badge" id="vs-opponent-rank">ü•â Bronze</div>
                        <div class="elo" id="vs-opponent-elo">1000 ELO</div>
                    </div>
                </div>

                <div class="match-info">
                    <span class="match-type" id="match-type">Duel 1v1 Class√©</span>
                </div>
            </div>
        </div>

        <!-- √âcran de Duel -->
        <div id="duel-screen" class="section-card" style="display: none;">
            <div class="duel-container">
                <!-- Header du duel -->
                <div class="duel-header">
                    <div class="player-status you">
                        <div class="avatar-small" id="duel-player-avatar">üë§</div>
                        <div class="player-name" id="duel-player-name">Vous</div>
                        <div class="hearts" id="player-hearts">
                            <span class="heart full">‚ù§Ô∏è</span>
                            <span class="heart full">‚ù§Ô∏è</span>
                            <span class="heart full">‚ù§Ô∏è</span>
                        </div>
                        <div class="score" id="player-score">0</div>
                    </div>

                    <div class="duel-info">
                        <div class="question-counter">
                            Question <span id="current-question">1</span>/<span id="total-questions">10</span>
                        </div>
                        <div class="duel-timer" id="duel-timer">15</div>
                        <div class="score-diff" id="score-diff">0-0</div>
                    </div>

                    <div class="player-status opponent">
                        <div class="avatar-small" id="duel-opponent-avatar">üë§</div>
                        <div class="player-name" id="duel-opponent-name">Adversaire</div>
                        <div class="hearts" id="opponent-hearts">
                            <span class="heart full">‚ù§Ô∏è</span>
                            <span class="heart full">‚ù§Ô∏è</span>
                            <span class="heart full">‚ù§Ô∏è</span>
                        </div>
                        <div class="score" id="opponent-score">0</div>
                    </div>
                </div>

                <!-- Zone de question -->
                <div class="question-area">
                    <div class="question-text" id="question-text">
                        Chargement de la question...
                    </div>

                    <div class="answers-grid" id="answers-grid">
                        <!-- Les r√©ponses seront inject√©es ici -->
                    </div>

                    <!-- Feedback apr√®s r√©ponse -->
                    <div class="answer-feedback" id="answer-feedback" style="display: none;">
                        <div class="feedback-content">
                            <div class="feedback-icon" id="feedback-icon">‚úÖ</div>
                            <div class="feedback-text" id="feedback-text">Bonne r√©ponse !</div>
                            <div class="opponent-answer" id="opponent-answer-status">
                                En attente de l'adversaire...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Barre de progression -->
                <div class="progress-bar-container">
                    <div class="progress-bar" id="question-progress"></div>
                </div>
            </div>
        </div>

        <!-- √âcran R√©sultats -->
        <div id="results-screen" class="section-card" style="display: none;">
            <div class="results-container">
                <div class="result-banner" id="result-banner">
                    <div class="result-icon" id="result-icon">üèÜ</div>
                    <h2 id="result-title">Victoire !</h2>
                </div>

                <div class="final-scores">
                    <div class="final-player you">
                        <div class="avatar" id="result-player-avatar">üë§</div>
                        <div class="name" id="result-player-name">Vous</div>
                        <div class="final-score" id="result-player-score">0</div>
                    </div>

                    <div class="score-separator">-</div>

                    <div class="final-player opponent">
                        <div class="avatar" id="result-opponent-avatar">üë§</div>
                        <div class="name" id="result-opponent-name">Adversaire</div>
                        <div class="final-score" id="result-opponent-score">0</div>
                    </div>
                </div>

                <div class="elo-change" id="elo-change-section">
                    <div class="elo-change-display" id="elo-change">
                        <span class="elo-label">Changement ELO</span>
                        <span class="elo-value positive" id="elo-diff">+25</span>
                    </div>
                    <div class="new-elo">
                        Nouveau classement : <strong id="new-elo">1025</strong> ELO
                    </div>
                    <div class="rank-progress" id="rank-progress">
                        <!-- Barre de progression vers le prochain rang -->
                    </div>
                </div>

                <div class="match-stats">
                    <h3>üìä Statistiques du match</h3>
                    <div class="stats-comparison">
                        <div class="stat-row">
                            <span class="stat-you" id="stat-correct-you">0</span>
                            <span class="stat-name">Bonnes r√©ponses</span>
                            <span class="stat-opponent" id="stat-correct-opponent">0</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-you" id="stat-time-you">0s</span>
                            <span class="stat-name">Temps moyen</span>
                            <span class="stat-opponent" id="stat-time-opponent">0s</span>
                        </div>
                        <div class="stat-row">
                            <span class="stat-you" id="stat-streak-you">0</span>
                            <span class="stat-name">Meilleure s√©rie</span>
                            <span class="stat-opponent" id="stat-streak-opponent">0</span>
                        </div>
                    </div>
                </div>

                <div class="results-actions">
                    <button class="btn-action primary" onclick="startMatchmaking(lastGameMode)">
                        üîÑ Revanche
                    </button>
                    <button class="btn-action secondary" onclick="backToLobby()">
                        üè† Retour au lobby
                    </button>
                </div>
            </div>
        </div>

        <!-- √âcran D√©connexion Adversaire -->
        <div id="disconnect-screen" class="section-card" style="display: none;">
            <div class="disconnect-container">
                <div class="disconnect-icon">üòî</div>
                <h2>Adversaire d√©connect√©</h2>
                <p>Votre adversaire a quitt√© la partie.</p>
                <p class="win-message">Vous remportez la victoire par forfait !</p>
                <button class="btn-action primary" onclick="backToLobby()">
                    Retour au lobby
                </button>
            </div>
        </div>
    </main>

    <footer>
        <p>Copyright ¬© 2024 SuperQuiz. Tous droits r√©serv√©s.</p>
        <p style="margin-top: 10px;">
            <a href="Mentions-Legales.html" style="color: white;">Mentions L√©gales</a> | 
            <a href="Politique-Confidentialite.html" style="color: white;">Politique de Confidentialit√©</a>
        </p>
    </footer>

    <script src="js/script.js"></script>
    <script src="js/multiplayer.js"></script>
</body>
</html>