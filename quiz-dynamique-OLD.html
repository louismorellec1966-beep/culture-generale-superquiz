<!DOCTYPE html>
<html lang="fr">
<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<!-- Configuration Firebase -->
<script src="firebase-config.js"></script>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperQuiz - Quiz Dynamique</title>
    <link rel="stylesheet" href="CSS/style.css">
    <style>
        .quiz-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 10px;
        }

        .quiz-header h1 {
            margin: 0;
            font-size: 2em;
        }

        .quiz-header p {
            margin: 10px 0 0 0;
            opacity: 0.9;
        }

        .breadcrumb {
            margin: 20px 0;
            font-size: 0.9em;
        }

        .breadcrumb a {
            color: #3498db;
            text-decoration: none;
        }

        .breadcrumb a:hover {
            text-decoration: underline;
        }

        .question-card {
            background: white;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            position: relative;
        }

        .question-card.challenge-mode {
            border-color: #e74c3c;
        }

        .global-timer {
            position: fixed;
            top: 50%;
            right: 20px;
            transform: translateY(-50%);
            background: linear-gradient(135deg, #e74c3c, #f39c12);
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            font-weight: bold;
            text-align: center;
            min-width: 120px;
            animation: floatTimer 3s ease-in-out infinite;
            display: none;
        }

        .global-timer.active {
            display: block;
        }

        .global-timer .timer-label {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .global-timer .timer-value {
            font-size: 2em;
            font-weight: bold;
        }

        .global-timer .timer-icon {
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        @keyframes floatTimer {

            0%,
            100% {
                transform: translateY(-50%) translateX(0);
            }

            50% {
                transform: translateY(-50%) translateX(-5px);
            }
        }

        @media (max-width: 768px) {
            .global-timer {
                top: auto;
                bottom: 20px;
                right: 20px;
                transform: none;
                animation: none;
            }
        }

        .question-timer {
            display: none;
        }

        .bonus-notification {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #2ecc71, #27ae60);
            color: white;
            padding: 30px 50px;
            border-radius: 15px;
            font-size: 2em;
            font-weight: bold;
            z-index: 10000;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: bonusAppear 0.5s ease;
            display: none;
        }

        @keyframes bonusAppear {
            0% {
                transform: translate(-50%, -50%) scale(0);
                opacity: 0;
            }

            50% {
                transform: translate(-50%, -50%) scale(1.1);
            }

            100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
        }

        .mode-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
            margin-left: 10px;
        }

        .mode-badge.classic {
            background: linear-gradient(135deg, #3498db, #2ecc71);
            color: white;
        }

        .mode-badge.challenge {
            background: linear-gradient(135deg, #e74c3c, #f39c12);
            color: white;
        }

        .score-display.challenge-mode {
            background: linear-gradient(135deg, #e74c3c, #f39c12);
        }

        .bonus-score {
            margin-top: 10px;
            font-size: 1em;
            color: #ffd700;
        }

        .question-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .question-number {
            background: #3498db;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9em;
            display: inline-block;
            margin-bottom: 10px;
        }

        .question-text {
            font-size: 1.2em;
            font-weight: bold;
            margin: 15px 0;
            color: #2c3e50;
        }

        .answer-option {
            display: block;
            margin: 12px 0;
            padding: 15px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
            position: relative;
        }

        .answer-option:hover {
            background: #f8f9fa;
            border-color: #3498db;
            transform: translateX(5px);
        }

        .answer-option.selected {
            background: #e3f2fd;
            border-color: #3498db;
            transform: translateX(5px);
        }

        .answer-option input[type="radio"] {
            margin-right: 10px;
            cursor: pointer;
            pointer-events: none;
        }

        .answer-option label {
            cursor: pointer;
            user-select: none;
            width: 100%;
            display: block;
            pointer-events: none;
        }

        .answer-option.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }

        .answer-option.disabled:hover {
            transform: none;
            border-color: #ecf0f1;
        }

        .loading {
            text-align: center;
            padding: 50px;
            font-size: 1.2em;
            color: #7f8c8d;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .error-message {
            background: #e74c3c;
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>

<body>
    <nav aria-label="Navigation principale">
        <button id="toggle-menu" aria-label="Ouvrir le menu" aria-expanded="false">
            <span class="hamburger"></span>
            <span class="hamburger"></span>
            <span class="hamburger"></span>
        </button>

        <ul class="menu">
            <li><a href="Accueil.html">Accueil</a></li>
            <li class="dropdown">
                <a href="Quiz.html">Quiz</a>
                <ul class="submenu">
                    <li><a href="Histoire.html">Histoire</a></li>
                    <li><a href="G√©ographie.html">G√©ographie</a></li>
                    <li><a href="Science.html">Science</a></li>
                    <li><a href="Litt√©rature.html">Litt√©rature</a></li>
                </ul>
            </li>
            <li><a href="Scores.html">Scores</a></li>
            <li><a href="Contact.html">Contact</a></li>
            <li><a href="Experimentation.html">Exp√©rience</a></li>
        </ul>
    </nav>

    <main>
        <div class="breadcrumb" id="breadcrumb"></div>

        <div class="quiz-header" id="quiz-header">
            <h1 id="quiz-title">Chargement...</h1>
            <p id="quiz-description"></p>
        </div>

        <div class="score-display" id="score-display">
            <p>Score : <span id="current-score">0</span> / <span id="total-questions">0</span></p>
            <p class="bonus-score" id="bonus-display" style="display: none;">
                ‚ö° Bonus : +<span id="bonus-points">0</span> pts
            </p>
        </div>

        <div id="quiz-container">
            <div class="loading">
                <div class="spinner"></div>
                <p>Chargement des questions...</p>
            </div>
        </div>

        <div id="global-timer" class="global-timer">
            <div class="timer-icon">‚è±Ô∏è</div>
            <div class="timer-label">Temps √©coul√©</div>
            <div class="timer-value" id="global-timer-value">0:00</div>
        </div>

        <div id="bonus-notification" class="bonus-notification"></div>

        <div class="score-reset-container" style="display: none;" id="reset-container">
            <h3>Terminer le quiz</h3>
            <p>Vous avez termin√© toutes les questions ? R√©initialisez votre score pour recommencer !</p>
            <button id="btn-reset-score" class="btn-reset">üîÑ R√©initialiser le score</button>
        </div>
    </main>

    <footer>
        <p>Copyright ¬© 2024 SuperQuiz. Tous droits r√©serv√©s.</p>
    </footer>

    <script src="js/script.js"></script>
    <script>
        // R√©cup√©rer les param√®tres de l'URL
        const urlParams = new URLSearchParams(window.location.search);
        const matiere = urlParams.get('matiere');
        const categorie = urlParams.get('categorie');
        const mode = urlParams.get('mode') || 'classic';

        let globalStartTime = null;
        let globalTimerInterval = null;
        let questionStartTimes = {};
        let bonusPoints = 0;

        // Donn√©es de quiz (fusionnez les deux parties JSON ici)
        const quizData = {
            "histoire": {
                "antiquite": { "titre": "üèõÔ∏è Antiquit√©", "questions": [{ "question": "Qui √©tait le premier empereur romain ?", "reponses": ["Auguste", "Jules C√©sar", "N√©ron", "Tib√®re"], "correct": 0 }, { "question": "En quelle ann√©e Jules C√©sar a-t-il √©t√© assassin√© ?", "reponses": ["44 av. J.-C.", "55 av. J.-C.", "33 av. J.-C.", "27 av. J.-C."], "correct": 0 }, { "question": "Quelle √©tait la capitale de l'√âgypte ancienne ?", "reponses": ["Memphis", "Alexandrie", "Th√®bes", "Le Caire"], "correct": 0 }, { "question": "Qui √©tait le dieu principal dans la mythologie grecque ?", "reponses": ["Zeus", "Pos√©idon", "Had√®s", "Apollon"], "correct": 0 }] },
                "moyenage": { "titre": "‚öîÔ∏è Moyen √Çge", "questions": [{ "question": "En quelle ann√©e a eu lieu la bataille de Hastings ?", "reponses": ["1066", "1096", "1215", "1337"], "correct": 0 }, { "question": "Qui a unifi√© les tribus mongoles ?", "reponses": ["Gengis Khan", "Kubila√Ø Khan", "Tamerlan", "Attila"], "correct": 0 }] },
                "art": { "titre": "üé® Histoire de l'Art", "questions": [{ "question": "Qui a peint la Joconde ?", "reponses": ["L√©onard de Vinci", "Michel-Ange", "Rapha√´l", "Botticelli"], "correct": 0 }] },
                "guerres": { "titre": "‚ö° Guerres Mondiales", "questions": [{ "question": "En quelle ann√©e a commenc√© la Premi√®re Guerre mondiale ?", "reponses": ["1914", "1915", "1916", "1917"], "correct": 0 }] },
                "france": { "titre": "üá´üá∑ Histoire de France", "questions": [{ "question": "En quelle ann√©e a eu lieu Marignan ?", "reponses": ["1515", "1519", "1518", "1517"], "correct": 0 }] },
                "contemporaine": { "titre": "üì± Histoire Contemporaine", "questions": [{ "question": "Ann√©e de la chute du mur de Berlin ?", "reponses": ["1989", "1987", "1991", "1985"], "correct": 0 }] }
            },
            "geographie": {
                "capitales": { "titre": "üèõÔ∏è Capitales", "questions": [{ "question": "Capitale de l'Australie ?", "reponses": ["Canberra", "Sydney", "Melbourne", "Brisbane"], "correct": 0 }] },
                "france": { "titre": "üá´üá∑ France", "questions": [{ "question": "Combien de r√©gions en France ?", "reponses": ["13", "22", "18", "15"], "correct": 0 }] },
                "europe": { "titre": "üá™üá∫ Europe", "questions": [{ "question": "Pays dans l'UE ?", "reponses": ["27", "28", "25", "30"], "correct": 0 }] },
                "continents": { "titre": "üåç Continents", "questions": [{ "question": "Plus grand oc√©an ?", "reponses": ["Pacifique", "Atlantique", "Indien", "Arctique"], "correct": 0 }] },
                "nature": { "titre": "üèîÔ∏è Physique", "questions": [{ "question": "Plus haut sommet ?", "reponses": ["Everest", "K2", "Kilimandjaro", "Mont Blanc"], "correct": 0 }] },
                "culture": { "titre": "üé≠ Culture", "questions": [{ "question": "O√π est la tour de Pise ?", "reponses": ["Italie", "France", "Espagne", "Gr√®ce"], "correct": 0 }] }
            },
            "science": {
                "physique": { "titre": "‚öõÔ∏è Physique", "questions": [{ "question": "Vitesse de la lumi√®re ?", "reponses": ["300 000 km/s", "150 000", "500 000", "200 000"], "correct": 0 }] },
                "chimie": { "titre": "üß™ Chimie", "questions": [{ "question": "Symbole de l'or ?", "reponses": ["Au", "Ag", "Fe", "Cu"], "correct": 0 }] },
                "biologie": { "titre": "üß¨ Biologie", "questions": [{ "question": "Support g√©n√©tique ?", "reponses": ["ADN", "ARN", "Prot√©ines", "Lipides"], "correct": 0 }] },
                "astronomie": { "titre": "üåå Astronomie", "questions": [{ "question": "Plan√®te proche du Soleil ?", "reponses": ["Mercure", "V√©nus", "Mars", "Terre"], "correct": 0 }] },
                "mathematiques": { "titre": "üìê Maths", "questions": [{ "question": "Valeur de œÄ ?", "reponses": ["3.14", "3.16", "3.12", "3.18"], "correct": 0 }] },
                "technologie": { "titre": "üíª Technologie", "questions": [{ "question": "P√®re de l'informatique ?", "reponses": ["Alan Turing", "Bill Gates", "Steve Jobs", "Tim"], "correct": 0 }] }
            },
            "litterature": {
                "classiques": { "titre": "üìö Classiques", "questions": [{ "question": "Auteur des Mis√©rables ?", "reponses": ["Victor Hugo", "Zola", "Flaubert", "Balzac"], "correct": 0 }] },
                "poesie": { "titre": "‚úçÔ∏è Po√©sie", "questions": [{ "question": "Auteur des Fleurs du mal ?", "reponses": ["Baudelaire", "Rimbaud", "Verlaine", "Mallarm√©"], "correct": 0 }] },
                "theatre": { "titre": "üé≠ Th√©√¢tre", "questions": [{ "question": "Auteur de Ph√®dre ?", "reponses": ["Racine", "Corneille", "Moli√®re", "Beaumarchais"], "correct": 0 }] },
                "romans": { "titre": "üìñ Romans XXe", "questions": [{ "question": "Auteur de L'√âtranger ?", "reponses": ["Camus", "Sartre", "Gide", "Malraux"], "correct": 0 }] },
                "mondiale": { "titre": "üåç Mondiale", "questions": [{ "question": "Auteur de Rom√©o et Juliette ?", "reponses": ["Shakespeare", "Moli√®re", "Goethe", "Dante"], "correct": 0 }] },
                "contemporaine": { "titre": "üì± Contemporaine", "questions": [{ "question": "Nobel 2014 ?", "reponses": ["Modiano", "Ernaux", "Le Cl√©zio", "Gao"], "correct": 0 }] }
            }
        };

        // Charger et afficher le quiz
        function loadQuiz() {
            if (!matiere || !categorie) {
                document.getElementById('quiz-container').innerHTML =
                    '<div class="error-message"><h2>Erreur</h2><p>Param√®tres de quiz manquants. <a href="Quiz.html" style="color: white;">Retour aux quiz</a></p></div>';
                return;
            }

            const quizContent = quizData[matiere]?.[categorie];

            if (!quizContent) {
                document.getElementById('quiz-container').innerHTML =
                    '<div class="error-message"><h2>Quiz introuvable</h2><p><a href="Quiz.html" style="color: white;">Retour aux quiz</a></p></div>';
                return;
            }

            // Mettre √† jour le titre
            const modeBadge = mode === 'challenge'
                ? '<span class="mode-badge challenge">üî• MODE D√âFI</span>'
                : '<span class="mode-badge classic">üéØ MODE CLASSIQUE</span>';
            document.getElementById('quiz-title').innerHTML = quizContent.titre + modeBadge;

            // Appliquer le style du mode d√©fi si n√©cessaire
            if (mode === 'challenge') {
                document.getElementById('score-display').classList.add('challenge-mode');
                document.getElementById('bonus-display').style.display = 'block';
            }

            // Fil d'Ariane
            const matiereNom = matiere.charAt(0).toUpperCase() + matiere.slice(1);
            document.getElementById('breadcrumb').innerHTML =
                `<a href="Quiz.html">Quiz</a> > <a href="${matiereNom}.html">${matiereNom}</a> > ${quizContent.titre}`;

            // Afficher les questions
            const container = document.getElementById('quiz-container');
            container.innerHTML = '';

            quizContent.questions.forEach((q, index) => {
                const questionDiv = document.createElement('div');
                questionDiv.className = 'question-card';
                if (mode === 'challenge') {
                    questionDiv.classList.add('challenge-mode');
                }

                questionDiv.innerHTML = `
                    <span class="question-number">Question ${index + 1}</span>
                    <div class="question-text">${q.question}</div>
                    ${q.reponses.map((rep, i) => `
                        <div class="answer-option" onclick="selectAnswer(${index}, ${i})">
                            <input type="radio" id="q${index}_r${i}" name="q${index}" value="${i}">
                            <label for="q${index}_r${i}">${rep}</label>
                        </div>
                    `).join('')}
                    <button class="btn-valider" onclick="validerQuestion(${index}, ${q.correct})">Valider</button>
                    <div id="feedback${index}" class="reponse-feedback"></div>
                `;
                container.appendChild(questionDiv);

                // D√©marrer le timer de la question en mode d√©fi
                if (mode === 'challenge') {
                    startQuestionTimer(index);
                }
            });

            document.getElementById('reset-container').style.display = 'block';
            document.getElementById('total-questions').textContent = quizContent.questions.length;

            // D√©marrer le chronom√®tre global en mode d√©fi
            if (mode === 'challenge') {
                startGlobalTimer();
            }
        }

        // Fonction pour s√©lectionner une r√©ponse en cliquant sur toute la zone
        function selectAnswer(qIndex, answerIndex) {
            const radio = document.getElementById(`q${qIndex}_r${answerIndex}`);
            if (radio && !radio.disabled) {
                radio.checked = true;

                // Retirer la classe selected de toutes les r√©ponses de cette question
                const allOptions = document.querySelectorAll(`input[name="q${qIndex}"]`).forEach(r => {
                    r.closest('.answer-option').classList.remove('selected');
                });

                // Ajouter la classe selected √† la r√©ponse cliqu√©e
                radio.closest('.answer-option').classList.add('selected');
            }
        }

        let answeredQuestions = new Set();
        let currentSession = null;

        // D√©marrer le chronom√®tre global
        function startGlobalTimer() {
            globalStartTime = Date.now();
            const timerElement = document.getElementById('global-timer');
            timerElement.classList.add('active');

            globalTimerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - globalStartTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById('global-timer-value').textContent =
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }, 100);
        }

        // Arr√™ter le chronom√®tre global
        function stopGlobalTimer() {
            if (globalTimerInterval) {
                clearInterval(globalTimerInterval);
            }
        }

        // Enregistrer le temps de d√©but d'une question
        function startQuestionTimer(qIndex) {
            questionStartTimes[qIndex] = Date.now();
        }

        // Calculer le temps √©coul√© pour une question
        function getQuestionTime(qIndex) {
            if (!questionStartTimes[qIndex]) return 0;
            return Math.floor((Date.now() - questionStartTimes[qIndex]) / 1000);
        }

        // Calculer les points bonus selon le nouveau bar√®me
        function calculateBonus(timeInSeconds) {
            // Nouveau bar√®me : minimum 12s requis pour avoir des bonus
            if (timeInSeconds < 12) return 0;  // Trop rapide, pas de bonus
            if (timeInSeconds <= 15) return 50; // Excellent (12-15s)
            if (timeInSeconds <= 20) return 30; // Tr√®s bien (16-20s)
            if (timeInSeconds <= 25) return 20; // Bien (21-25s)
            if (timeInSeconds <= 30) return 10; // Correct (26-30s)
            return 0; // Trop lent, pas de bonus
        }

        // Afficher notification de bonus
        function showBonusNotification(bonus) {
            const notification = document.getElementById('bonus-notification');
            notification.textContent = `+${bonus} points bonus ! üî•`;
            notification.style.display = 'block';

            setTimeout(() => {
                notification.style.display = 'none';
            }, 1500);
        }

        // Mettre √† jour l'affichage du bonus
        function updateBonusDisplay() {
            const bonusElement = document.getElementById('bonus-points');
            if (bonusElement) {
                bonusElement.textContent = bonusPoints;
            }
        }

        function validerQuestion(qIndex, correctAnswer) {
            const selected = document.querySelector(`input[name="q${qIndex}"]:checked`);
            if (!selected) {
                alert('Veuillez s√©lectionner une r√©ponse');
                return;
            }

            // √âviter de r√©pondre deux fois √† la m√™me question
            if (answeredQuestions.has(qIndex)) {
                return;
            }

            const feedback = document.getElementById(`feedback${qIndex}`);
            const isCorrect = parseInt(selected.value) === correctAnswer;

            if (isCorrect) {
                feedback.className = 'reponse-feedback correct';
                feedback.innerHTML = '‚úÖ Bravo ! Bonne r√©ponse !';
                feedback.style.display = 'block';

                // Incr√©menter le score
                const currentScore = parseInt(document.getElementById('current-score').textContent);
                document.getElementById('current-score').textContent = currentScore + 1;
            } else {
                feedback.className = 'reponse-feedback incorrect';
                feedback.innerHTML = '‚ùå Incorrect. Essayez √† nouveau !';
                feedback.style.display = 'block';
            }

            // Marquer comme r√©pondue
            answeredQuestions.add(qIndex);

            // D√©sactiver les radios
            document.querySelectorAll(`input[name="q${qIndex}"]`).forEach(r => r.disabled = true);

            // V√©rifier si toutes les questions sont r√©pondues
            const totalQuestions = parseInt(document.getElementById('total-questions').textContent);
            if (answeredQuestions.size === totalQuestions) {
                setTimeout(saveScore, 500);
            }
        }


        // Sauvegarder le score
        async function saveScore() {
            // Arr√™ter le chronom√®tre global en mode d√©fi
            if (mode === 'challenge') {
                stopGlobalTimer();
            }

            // V√©rifier si l'utilisateur est connect√©
            const user = FirebaseAuth.getCurrentUser();

            if (!user) {
                if (confirm('Voulez-vous vous connecter pour sauvegarder votre score ?')) {
                    window.location.href = 'Auth.html';
                }
                return;
            }

            const score = parseInt(document.getElementById('current-score').textContent);
            const total = parseInt(document.getElementById('total-questions').textContent);
            const quizTitle = document.getElementById('quiz-title').textContent.split('<')[0];

            const scoreData = {
                matiere: matiere,
                categorie: categorie,
                titre: quizTitle,
                score: score,
                total: total,
                mode: mode,
                bonusPoints: mode === 'challenge' ? bonusPoints : 0,
                totalScore: mode === 'challenge' ? score + bonusPoints : score
            };

            try {
                await FirebaseScores.save(scoreData);

                let message = `‚úÖ Score sauvegard√© : ${score}/${total} (${Math.round((score / total) * 100)}%)`;
                if (mode === 'challenge') {
                    message += `\n‚ö° Points bonus : +${bonusPoints}\nüèÜ Score total : ${score + bonusPoints}`;
                }
                message += '\n\nConsultez tous vos scores dans la section "Scores" !';

                alert(message);
            } catch (error) {
                console.error('Erreur sauvegarde:', error);
                alert('‚ùå Erreur lors de la sauvegarde du score');
            }
        }

        // R√©cup√©rer les scores existants
        let scores = [];
        const scoresStr = localStorage.getItem(`scores:${session.email}`);
        if (scoresStr) {
            scores = JSON.parse(scoresStr);
        }

        // Ajouter le nouveau score
        scores.push(scoreData);

        // Sauvegarder
        localStorage.setItem(`scores:${session.email}`, JSON.stringify(scores));

        // Afficher notification
        let message = `‚úÖ Score sauvegard√© : ${score}/${total} (${Math.round((score / total) * 100)}%)`;
        if (mode === 'challenge') {
            message += `\n‚ö° Points bonus : +${bonusPoints}\nüèÜ Score total : ${score + bonusPoints}`;
        }
        message += '\n\nConsultez tous vos scores dans la section "Scores" !';

        alert(message);
        

        // V√©rifier la session au chargement
        function checkSession() {
            const sessionStr = localStorage.getItem('session:current');
            if (sessionStr) {
                currentSession = JSON.parse(sessionStr);
                updateAuthMenu();
            }
        }

        // Mettre √† jour le menu
        function updateAuthMenu() {
            const nav = document.querySelector('.menu');
            const existingAuthItem = document.getElementById('auth-menu-item');

            if (existingAuthItem) {
                existingAuthItem.remove();
            }

            const authItem = document.createElement('li');
            authItem.id = 'auth-menu-item';

            if (currentSession && currentSession.connected) {
                authItem.innerHTML = `<a href="#" onclick="logout(event)" title="D√©connexion">üë§ ${currentSession.name}</a>`;
            } else {
                authItem.innerHTML = '<a href="Auth.html">Connexion</a>';
            }

            nav.appendChild(authItem);
        }

        // D√©connexion
        function logout(event) {
            event.preventDefault();
            if (confirm('Voulez-vous vraiment vous d√©connecter ?')) {
                localStorage.removeItem('session:current');
                window.location.href = 'Accueil.html';
            }
        }

        // Charger le quiz au chargement de la page
        document.addEventListener('DOMContentLoaded', () => {
            checkSession();
            loadQuiz();
        });
        // Gestion du menu d'authentification Firebase
        FirebaseAuth.onAuthStateChanged(user => {
            const nav = document.querySelector('.menu');
            if (!nav) return;

            const existingAuthItem = document.getElementById('auth-menu-item');
            if (existingAuthItem) existingAuthItem.remove();

            const authItem = document.createElement('li');
            authItem.id = 'auth-menu-item';

            if (user) {
                authItem.innerHTML = `
                    <a href="#" onclick="logout(event)" style="color: #2ecc71;">
                        üë§ ${user.name} <span style="font-size: 0.8em;">(D√©co)</span>
                    </a>
                `;
            } else {
                authItem.innerHTML = '<a href="Auth.html" style="color: #e74c3c;">üîê Connexion</a>';
            }

            nav.appendChild(authItem);
        });

        // Fonction de d√©connexion
        async function logout(event) {
            event.preventDefault();
            if (confirm('Voulez-vous vraiment vous d√©connecter ?')) {
                try {
                    await FirebaseAuth.logout();
                    alert('D√©connexion r√©ussie !');
                    window.location.href = 'Accueil.html';
                } catch (error) {
                    alert('Erreur lors de la d√©connexion');
                }
            }
        }
    </script>
</body>

</html>