<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Final Firebase</title>
    <!-- Firebase SDK -->
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script defer src="firebase-config.js"></script>
</head>
<body>
    <h1>üéØ Test Final Configuration Firebase</h1>
    <p>V√©rification finale apr√®s correction de l'avertissement Firestore.</p>

    <button onclick="runFinalTest()">Lancer le test final</button>
    <div id="results" style="margin-top: 20px; font-family: monospace; white-space: pre-line;"></div>

    <script>
        async function runFinalTest() {
            const results = document.getElementById('results');
            results.textContent = 'üîÑ Test final de la configuration Firebase...\n\n';

            // Attendre que tout soit charg√©
            await new Promise(resolve => setTimeout(resolve, 3000));

            let errorCount = 0;
            let warningCount = 0;

            // Capturer les erreurs et avertissements de la console
            const originalWarn = console.warn;
            const originalError = console.error;

            console.warn = function(...args) {
                warningCount++;
                results.textContent += `‚ö†Ô∏è AVERTISSEMENT: ${args.join(' ')}\n`;
                originalWarn.apply(console, args);
            };

            console.error = function(...args) {
                errorCount++;
                results.textContent += `‚ùå ERREUR: ${args.join(' ')}\n`;
                originalError.apply(console, args);
            };

            try {
                // Test 1: V√©rifier l'initialisation Firebase
                if (typeof firebase !== 'undefined' && typeof window.db !== 'undefined') {
                    results.textContent += '‚úÖ Firebase initialis√© correctement\n';
                } else {
                    results.textContent += '‚ùå Probl√®me d\'initialisation Firebase\n';
                    errorCount++;
                }

                // Test 2: V√©rifier les param√®tres Firestore
                const settings = firebase.firestore()._settings;
                if (settings) {
                    results.textContent += '‚úÖ Param√®tres Firestore configur√©s\n';
                    results.textContent += `   experimentalForceLongPolling: ${settings.experimentalForceLongPolling}\n`;
                    results.textContent += `   experimentalAutoDetectLongPolling: ${settings.experimentalAutoDetectLongPolling}\n`;
                }

                // Test 3: Test de connexion
                try {
                    await window.db.collection('profiles').limit(1).get();
                    results.textContent += '‚úÖ Connexion Firestore r√©ussie\n';
                } catch (error) {
                    results.textContent += `‚ùå Erreur de connexion: ${error.message}\n`;
                    errorCount++;
                }

                // Test 4: V√©rifier qu'il n'y a pas d'avertissements Firebase
                setTimeout(() => {
                    results.textContent += `\nüìä R√âSULTATS:\n`;
                    results.textContent += `   Erreurs d√©tect√©es: ${errorCount}\n`;
                    results.textContent += `   Avertissements d√©tect√©s: ${warningCount}\n`;

                    if (errorCount === 0 && warningCount === 0) {
                        results.textContent += '\nüéâ SUCC√àS ! Aucune erreur ou avertissement Firebase.\n';
                    } else if (errorCount === 0 && warningCount > 0) {
                        results.textContent += '\n‚ö†Ô∏è Configuration fonctionnelle mais avec avertissements.\n';
                    } else {
                        results.textContent += '\n‚ùå Des erreurs subsistent.\n';
                    }

                    // Restaurer les fonctions console
                    console.warn = originalWarn;
                    console.error = originalError;
                }, 1000);

            } catch (error) {
                results.textContent += `\nüí• ERREUR G√âN√âRALE: ${error.message}\n`;
                errorCount++;

                // Restaurer les fonctions console
                console.warn = originalWarn;
                console.error = originalError;
            }
        }
    </script>
</body>
</html>