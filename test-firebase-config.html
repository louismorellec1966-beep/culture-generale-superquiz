<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Configuration Firebase</title>
    <!-- Firebase SDK -->
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script defer src="firebase-config.js"></script>
</head>
<body>
    <h1>üß™ Test Configuration Firebase</h1>
    <p>Test de la configuration Firebase apr√®s corrections.</p>

    <button onclick="testFirebaseConfig()">Tester la configuration</button>
    <div id="results" style="margin-top: 20px; font-family: monospace; white-space: pre-line;"></div>

    <script>
        async function testFirebaseConfig() {
            const results = document.getElementById('results');
            results.textContent = 'üîÑ Test de la configuration Firebase...\n\n';

            try {
                // Attendre Firebase
                await new Promise(resolve => setTimeout(resolve, 3000));

                // Test 1: V√©rifier que Firebase est charg√©
                if (typeof firebase !== 'undefined') {
                    results.textContent += '‚úÖ Firebase SDK charg√©\n';
                } else {
                    results.textContent += '‚ùå Firebase SDK non charg√©\n';
                    return;
                }

                // Test 2: V√©rifier que db est d√©fini globalement
                if (typeof window.db !== 'undefined' && window.db) {
                    results.textContent += '‚úÖ window.db d√©fini et accessible\n';
                } else {
                    results.textContent += '‚ùå window.db non d√©fini ou inaccessible\n';
                }

                // Test 3: V√©rifier que auth est d√©fini globalement
                if (typeof window.auth !== 'undefined' && window.auth) {
                    results.textContent += '‚úÖ window.auth d√©fini et accessible\n';
                } else {
                    results.textContent += '‚ùå window.auth non d√©fini ou inaccessible\n';
                }

                // Test 4: V√©rifier les param√®tres Firestore
                try {
                    const settings = firebase.firestore()._settings;
                    if (settings) {
                        results.textContent += '‚úÖ Param√®tres Firestore accessibles\n';
                        results.textContent += `   experimentalForceLongPolling: ${settings.experimentalForceLongPolling || false}\n`;
                        results.textContent += `   experimentalAutoDetectLongPolling: ${settings.experimentalAutoDetectLongPolling || false}\n`;
                    } else {
                        results.textContent += '‚ö†Ô∏è Param√®tres Firestore non accessibles\n';
                    }
                } catch (error) {
                    results.textContent += `‚ùå Erreur param√®tres Firestore: ${error.message}\n`;
                }

                // Test 5: Test de connexion basique
                try {
                    const testQuery = await window.db.collection('profiles').limit(1).get();
                    results.textContent += '‚úÖ Connexion Firestore r√©ussie\n';
                } catch (error) {
                    results.textContent += `‚ùå Erreur connexion Firestore: ${error.message}\n`;
                }

                // Test 6: V√©rifier qu'il n'y a pas d'erreurs QUIC
                const hasQuicErrors = results.textContent.includes('QUIC');
                if (!hasQuicErrors) {
                    results.textContent += '‚úÖ Aucune erreur QUIC d√©tect√©e\n';
                } else {
                    results.textContent += '‚ùå Erreurs QUIC pr√©sentes\n';
                }

                results.textContent += '\nüèÅ TESTS TERMIN√âS\n';

                // R√©sum√©
                const errorCount = (results.textContent.match(/‚ùå/g) || []).length;
                if (errorCount === 0) {
                    results.textContent += '\nüéâ TOUS LES TESTS R√âUSSIS ! Configuration Firebase OK.';
                } else {
                    results.textContent += `\n‚ö†Ô∏è ${errorCount} erreur(s) d√©tect√©e(s). V√©rifiez la configuration.`;
                }

            } catch (error) {
                results.textContent += `\nüí• ERREUR G√âN√âRALE: ${error.message}\n`;
            }
        }
    </script>
</body>
</html>